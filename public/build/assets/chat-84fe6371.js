import{i as z,g as J,o as W}from"./index.esm2017-9b56508e.js";function G(d){const u=d.parentElement,m=document.createElement("button"),c=document.createElement("div");m.textContent="üòâ",m.type="button",m.classList.add("emoji-button"),c.classList.add("emoji-picker"),c.style.position="absolute",c.style.bottom="50px",c.style.left="10px";const M=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let r="";M.forEach(a=>{r+=`<span class="emoji-item">${a}</span>`}),c.innerHTML=r,c.addEventListener("click",a=>{if(a.target.classList.contains("emoji-item")){const p=a.target.textContent,h=d.selectionStart,f=d.value.substring(0,h),C=d.value.substring(h);d.value=f+p+C;const y=h+p.length;d.selectionStart=y,d.selectionEnd=y,d.focus()}}),u.appendChild(m),u.appendChild(c),c.style.display="none",m.addEventListener("click",a=>{a.stopPropagation(),c.style.display=c.style.display==="none"?"flex":"none"}),document.addEventListener("click",a=>{!c.contains(a.target)&&!m.contains(a.target)&&(c.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{const d=window.Laravel.user.id,u=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=window.pinImgUrl,c=window.unpinImgUrl,M=window.deleteImgUrl;let r=null,a=null,p=new Set,h=!1;function f(t,n){Notification.permission==="granted"&&new Notification(t,{body:n})}function C(t){return new Date(t).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function y(t){const n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,e=>n[e])}function O(){const t=document.getElementById("chat-messages");t.scrollTop=t.scrollHeight}function v(){document.querySelectorAll("#chat-messages ul li").forEach(t=>{t.style.display=h?t.classList.contains("pinned")?"":"none":""})}function S(t,n){const o=document.getElementById("chat-messages").querySelector("ul");let i="";t.forEach(s=>{if(!p.has(s.id)){if(s.message_type==="notification"||s.is_system)i+=`
                        <li class="system-notification" data-id="${s.id}">
                            ${s.message}
                            <span class="message-time">${C(s.created_at)}</span>
                        </li>
                    `;else{const l=s.sender_id===n,U=s.message_type==="notification"?"notification-message":l?"my-message":"other-message",X=s.is_pinned?"pinned":"";let N="";l&&s.is_read&&(N='<span class="read-status">‚úì‚úì</span>');let g="";s.message&&s.message.trim()!==""&&(s.message_type==="notification"?g+=s.message:g+=`<div>${y(s.message)}</div>`),s.attachments&&s.attachments.length>0&&s.attachments.forEach(b=>{b.mime&&b.mime.startsWith("image/")?g+=`<div><img src="${b.url}" alt="Image" style="max-width:100%; border-radius:4px;"></div>`:g+=`<div><a href="${b.url}" target="_blank">${y(b.original_file_name)}</a></div>`}),g.trim()===""&&(g='<div style="color:#888;">[–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]</div>');let B="";l&&(B=`
                            <div class="message-controls">
                                <button class="delete-message" data-id="${s.id}"><img src="${M}" alt="–£–¥–∞–ª–∏—Ç—å"></button>
                                ${s.is_pinned?`<button class="unpin-message" data-id="${s.id}"><img src="${c}" alt="–û—Ç–∫—Ä–µ–ø–∏—Ç—å"></button>`:`<button class="pin-message" data-id="${s.id}"><img src="${m}" alt="–ó–∞–∫—Ä–µ–ø–∏—Ç—å"></button>`}
                            </div>
                        `),i+=`
                        <li class="${U} ${X}" data-id="${s.id}">
                            <div><strong>${l?"–í—ã":y(s.sender_name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")}</strong></div>
                            ${g}
                            ${B}
                            <span class="message-time">${C(s.created_at)}</span>
                            ${N}
                        </li>
                    `,s.sender_id!==n&&f("–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",s.message)}p.add(s.id)}}),i&&(o.insertAdjacentHTML("beforeend",i),O(),x(),v())}function x(){document.querySelectorAll(".delete-message").forEach(t=>{t.onclick=function(){const n=this.getAttribute("data-id");confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")&&fetch(`/chats/${a}/${r}/messages/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":u,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?this.closest("li").remove():alert(e.error||"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è")}).catch(e=>console.error("–û—à–∏–±–∫–∞:",e))}}),document.querySelectorAll(".pin-message").forEach(t=>{t.onclick=function(){const n=this.getAttribute("data-id");fetch(`/chats/${a}/${r}/messages/${n}/pin`,{method:"POST",headers:{"X-CSRF-TOKEN":u,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.success){this.innerHTML=`<img src="${c}" alt="–û—Ç–∫—Ä–µ–ø–∏—Ç—å">`,this.classList.remove("pin-message"),this.classList.add("unpin-message");let o=this.closest("li");if(o.classList.add("pinned"),o&&!o.querySelector(".pinned-label")){let i=document.createElement("span");i.classList.add("pinned-label"),i.textContent=" [–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ]",o.querySelector("div").appendChild(i)}v()}else alert(e.error||"–û—à–∏–±–∫–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è")}).catch(e=>console.error("–û—à–∏–±–∫–∞:",e))}}),document.querySelectorAll(".unpin-message").forEach(t=>{t.onclick=function(){const n=this.getAttribute("data-id");fetch(`/chats/${a}/${r}/messages/${n}/unpin`,{method:"POST",headers:{"X-CSRF-TOKEN":u,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.success){this.innerHTML=`<img src="${m}" alt="–ó–∞–∫—Ä–µ–ø–∏—Ç—å">`,this.classList.remove("unpin-message"),this.classList.add("pin-message");let o=this.closest("li");o.classList.remove("pinned");let i=o.querySelector(".pinned-label");i&&i.remove(),v()}else alert(e.error||"–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è")}).catch(e=>console.error("–û—à–∏–±–∫–∞:",e))}})}function T(t,n){r=t,a=n;const o=document.getElementById("chat-messages").querySelector("ul");o.innerHTML="",p.clear();const i=document.querySelector(`[data-chat-id="${t}"][data-chat-type="${n}"] h5`),s=document.getElementById("chat-header");s.textContent=i?i.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",fetch(`/chats/${n}/${t}/messages`).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{S(l.messages,d),w(t,n),P(t,n)}).catch(l=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",l),f("–û—à–∏–±–∫–∞","–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º.")})}function I(){if(!r||!$.value.trim()&&!document.querySelector(".file-input").files[0])return;const t=$.value.trim(),e=document.querySelector(".file-input").files;let o=new FormData;o.append("message",t);for(let i=0;i<e.length;i++)o.append("files[]",e[i]);fetch(`/chats/${a}/${r}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":u},body:o}).then(i=>i.ok?i.json():i.text().then(s=>{throw new Error(s)})).then(i=>{i.message&&(S([i.message],i.message.sender_id),$.value="",document.querySelector(".file-input").value="")}).catch(i=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",i))}function w(t,n){fetch(`/chats/${n}/${t}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":u}}).catch(e=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",e))}function q(t,n,e=!0){const o=document.querySelector(`[data-chat-id="${t}"][data-chat-type="${n}"]`);if(o){const i=o.querySelector(".unread-count");let s=parseInt(i.textContent)||0;s=e?s+1:Math.max(s-1,0),i.textContent=s,i.style.display=s>0?"inline":"none"}}function H(t,n,e){const o=document.querySelector(`[data-chat-id="${t}"][data-chat-type="${n}"]`);if(o){document.getElementById("chat-list").prepend(o);const s=o.querySelector("h5");s.textContent=e.sender_name+": "+e.message.substring(0,50)+"...",q(t,n)}}function P(t,n){window.Echo&&window.Echo.private(`user.${d}`).listen(".message.sent",e=>{e.message.chat_id==t&&e.message.chat_type==n?(S([e.message],e.message.sender_id),w(t,n)):(q(e.message.chat_id,e.message.chat_type),H(e.message.chat_id,e.message.chat_type,e.message))})}function R(){fetch("/chats/unread-counts",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":u}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.unread_counts&&t.unread_counts.forEach(n=>{const e=document.querySelector(`[data-chat-id="${n.id}"][data-chat-type="${n.type}"]`);if(e){document.getElementById("chat-list").prepend(e);const i=e.querySelector(".unread-count");i.textContent=n.unread_count,i.style.display=n.unread_count>0?"inline":"none"}})}).catch(t=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",t))}setInterval(R,500);const E=document.getElementById("chat-list");E&&E.addEventListener("click",t=>{const n=t.target.closest("li");if(!n)return;const e=n.getAttribute("data-chat-id"),o=n.getAttribute("data-chat-type");r===e&&a===o||T(e,o)});const k=document.getElementById("search-chats"),L=document.getElementById("search-results");k&&k.addEventListener("input",function(){const t=k.value.trim().toLowerCase();t===""?(L.style.display="none",Array.from(E.children).forEach(n=>{n.style.display="flex"})):(Array.from(E.children).forEach(n=>{const e=n.querySelector("h5").textContent.toLowerCase();n.style.display=e.includes(t)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":u},body:JSON.stringify({query:t})}).then(n=>n.json()).then(n=>{let e="";n.chats&&n.chats.length>0&&(e+="<h5>–ß–∞—Ç—ã</h5><ul>",n.chats.forEach(o=>{e+=`<li data-chat-id="${o.id}" data-chat-type="${o.type}">${o.name}</li>`}),e+="</ul>"),n.messages&&n.messages.length>0&&(e+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",n.messages.forEach(o=>{let i=o.chat_id,s="group";i||(s="personal",i=o.sender_id==d?o.receiver_id:o.sender_id),e+=`<li data-chat-id="${i}" data-chat-type="${s}" data-message-id="${o.id}">
                                <strong>${o.sender_name}:</strong> ${o.message.substring(0,50)}...
                                <br><small>${C(o.created_at)}</small>
                            </li>`}),e+="</ul>"),L.innerHTML=e,L.style.display=e.trim()===""?"none":"block",Array.from(L.querySelectorAll("li")).forEach(o=>{o.addEventListener("click",function(){const i=this.getAttribute("data-chat-id"),s=this.getAttribute("data-chat-type"),l=this.getAttribute("data-message-id");T(i,s),k.value="",L.style.display="none",l&&setTimeout(()=>{},500)})})}).catch(n=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",n)))});function j(){const t=document.querySelector(".attach-file"),n=document.querySelector(".file-input");t&&n&&(t.addEventListener("click",()=>{n.click()}),n.addEventListener("change",()=>{n.files.length>0&&I()}))}document.readyState!=="loading"?j():document.addEventListener("DOMContentLoaded",j);const A=document.getElementById("send-message"),$=document.getElementById("chat-message");A&&A.addEventListener("click",I),$&&$.addEventListener("keypress",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),I())}),G($);function F(){Notification.permission==="granted"?f("–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ","–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏."):Notification.permission!=="denied"&&Notification.requestPermission().then(t=>{t==="granted"&&f("–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ","–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.")})}F(),document.addEventListener("DOMContentLoaded",()=>{const t=E?E.querySelector("li"):null;t&&t.click()}),setInterval(()=>{if(r&&a){const n=document.getElementById("chat-messages").querySelector("ul");fetch(`/chats/${a}/${r}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":u},body:JSON.stringify({last_message_id:n.lastElementChild?parseInt(n.lastElementChild.getAttribute("data-id")):0})}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.messages&&(S(e.messages,e.current_user_id),w(r,a))}).catch(e=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",e),f("–û—à–∏–±–∫–∞","–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º.")})}},500),document.addEventListener("click",function(t){if(t.target.matches(".notification-message a[data-message-id]")){t.preventDefault();const n=t.target.dataset.messageId,e=document.querySelector(`li[data-id="${n}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.style.backgroundColor="#007ab6",setTimeout(()=>{e.style.backgroundColor=""},500))}});const _=document.getElementById("toggle-pinned");_&&_.addEventListener("click",()=>{h=!h,_.textContent=h?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",v()});const K=z({apiKey:"AIzaSyB6N1n8dW95YGMMuTsZMRnJY1En7lK2s2M",authDomain:"dlk-diz.firebaseapp.com",projectId:"dlk-diz",storageBucket:"dlk-diz.firebasestorage.app",messagingSenderId:"209164982906",appId:"1:209164982906:web:0836fbb02e7effd80679c3"}),D=J(K);W(D,t=>{console.log("Message received. ",t),new Notification(t.notification.title,{body:t.notification.body,icon:t.notification.icon})})});
